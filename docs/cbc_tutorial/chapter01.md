
# 目的

本教程的目的主要是学习如何使用llvm开发一门语言。  
本教程**不会**把已有的能力重新实现一遍，而是会尽可能利用现有的轮子。  
这是因为读者在实际的工作和生产中，也不会重复造轮子，肯定也是优先使用那些成熟的模块，只有未提供的部分，才需要去自己实现。  

# 编写背景  

本人所了解过的，真正产出可以直接在实际的机器上（而不是自己搞个指令模拟器/虚拟机）运行的可执行文件的编译器教程，只有青木峰郎原著的《自制编译器》这一本书。

> 《自制编译器》（青木峰郎著，严圣逸/绝云译，人民邮件出版社2016年版）

这本书的中文翻译本于2016年出版，但是日文原文对应的内容实际在2009年就完成了。  
所以，这本书里面采用的开发环境，编译使用的仍然为32位x86指令集，基本也都是那个时候的标配。  
但是，从那个时候持续到2022年的现在，开发环境早已经升级了，而且主流的架构也变成了x86_64/amd64 （甚至也包括arm64），并且反过来，为2009年的程序提供支持都已经变得十分困难了。

ubuntu在18.04版本开始，就已经不再完善支持32位应用运行了。  

我自己曾经尝试过在现有的64位ubuntu 16/18/20上搭起来支持书中的cb编译器的开发环境，但是经历过很多尝试都失败了。某天又一次尝试失败之后，我突然有一种想法：就是这些针对老古董32位的支持，即使学习了，或者配置成功了（虽然还有很多坑），除了教学之外，对于实际的生产又有什么用呢？

想到这里，我就冒出一种想法，既然让程序在老古董支持下跑起来已经很困难了，为什么我们不重新改造一下，让这个程序可以在我们现在的环境中执行呢？于是，我就开始了我的重写之旅。

# 选型

我们的目的是，支持编译Cb语言，并且可以在我们现有的x86_64的系统上正确生成目标文件。  
这些目标文件是真实的目标文件，可以和gcc/clang等主流编译系统，编译生成的目标文件互相链接调用，生成可执行文件。  
目前业界在开发新语言的技术选型上基本只有一家：LLVM；我们也选择之。  
利用LLVM，在开发编译器时，我们的重点就可以由生成整个二进制格式转变为生成LLVM-IR。
而LLVM为LLVM-IR提供了很完善的工具支持，也提供了很多编程库与接口。  

当然，开发Cb编译器的编程语言，自然也要选择用C++了。  
搞LLVM开发，编译器自然也是要用clang了。我们会在容器中，使用clang-15进行开发。  
LLVM默认使用的C++标准为C++14，不过clang-15已经完整支持了C++17，所以，我们自己编写的代码，会支持到C++17标准。  

除了标准库与LLVM（及LLVM使用的第三方库）之外，我们不会用到第三方库。即便未来需要的话，也优先寻找LLVM内部实现的轮子。  

# 代码路径

本教程的代码路径为：[https://gitee.com/zdking/llvm_learn.git](https://gitee.com/zdking/llvm_learn.git)  
